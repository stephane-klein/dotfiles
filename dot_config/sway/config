### Variables
#
# Logo key. Use Mod1 for Alt.

default_border none
workspace_layout tabbed

input * {
    xkb_layout "fr"
    xkb_variant "bepo"

    # Swap Left Ctrl with Left Win
    xkb_options ctrl:swap_lwin_lctl
    repeat_rate 50
    repeat_delay 350

    dwt enabled
    tap enabled
}

# Ctrl on my TypeMatrix and Thinkpad
set $mod Mod4

set $term foot
set $menu fuzzel | xargs swaymsg exec --

set $screenshot grim ~/screenshots/scrn-$(date +"%Y-%m-%d-%H-%M-%S").png
set $screenclip slurp | grim -g - ~/screenshots/scrn-$(date +"%Y-%m-%d-%H-%M-%S").png

set $workspace_web 1:web
set $workspace_code 2:code
set $workspace_signal 3:signal
set $workspace_slack 4:slack
set $workspace_mattermost 5:mattermost
set $workspace_joplin 6:joplin

set $WOBSOCK $XDG_RUNTIME_DIR/wob.sock
exec rm -f $WOBSOCK && mkfifo $WOBSOCK && tail -f $WOBSOCK | wob

### Key bindings
#
# Basics:
#
    # Start a terminal
    bindsym $mod+Return exec $term
    bindsym $mod+Space exec $menu

    # Kill focused window
    bindsym $mod+q kill

    bindsym XF86MonBrightnessDown exec brightnessctl set 5%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
    bindsym XF86MonBrightnessUp exec brightnessctl set +5% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK

    # Reload the configuration file
    bindsym $mod+Shift+r reload

    # Exit sway (logs you out of your Wayland session)
    bindsym $mod+Shift+q exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -B 'Yes, exit sway' 'swaymsg exit'

    bindsym $mod+Shift+l exec 'swaylock -f -c 000000'

    # Move your focus around
    bindsym $mod+Left focus left
    bindsym $mod+Down focus down
    bindsym $mod+Up focus up
    bindsym $mod+Right focus right

    # Ditto, with arrow keys
    bindsym $mod+Shift+Left move left
    bindsym $mod+Shift+Down move down
    bindsym $mod+Shift+Up move up
    bindsym $mod+Shift+Right move right

    # Switch to workspace
    bindsym $mod+quotedbl workspace $workspace_web
    bindsym $mod+guillemotleft workspace $workspace_code
    bindsym $mod+guillemotright workspace $workspace_signal
    bindsym $mod+parenleft workspace $workspace_slack
    bindsym $mod+parenright workspace $workspace_mattermost
    bindsym $mod+at workspace number $workspace_joplin
    bindsym $mod+plus workspace number 7
    bindsym $mod+minus workspace number 8
    bindsym $mod+slash workspace number 9
    bindsym $mod+asterisk workspace number 10
    bindsym $mod+equal workspace number 11
    bindsym $mod+percent workspace number 12

    # Screenshot
    bindsym --no-repeat $mod+Print exec $screenshot
    bindsym --no-repeat $mod+Shift+Print exec $screenclip

    bindsym $mod+Shift+quotedbl move container to workspace $workspace_web
    bindsym $mod+Shift+guillemotleft move container to workspace $workspace_code
    bindsym $mod+Shift+guillemotright move container to workspace $workspace_signal
    bindsym $mod+Shift+parenleft move container to workspace $workspace_slack
    bindsym $mod+Shift+parenright move container to workspace $workspace_mattermost
    bindsym $mod+Shift+at move container to workspace $workspace_joplin
    bindsym $mod+Shift+plus move container to workspace number 7
    bindsym $mod+Shift+minus move container to workspace number 8
    bindsym $mod+Shift+slash move container to workspace number 9
    bindsym $mod+Shift+asterisk move container to workspace number 10
    bindsym $mod+Shift+equal move container to workspace number 11
    bindsym $mod+Shift+percent move container to workspace number 12

    bindsym $mod+Shift+space floating toggle
    #bindsym $mod+space focus mode_toggle
    bindsym $mod+a focus parent
    bindsym $mod+r mode "resize"
    bindsym $mod+t layout tabbed
    bindsym $mod+h layout splith
    bindsym $mod+v layout splitv

    # Make the current focus fullscreen
    bindsym $mod+f fullscreen

    mode "resize" {
        bindsym Left resize shrink width 10px
        bindsym Down resize grow height 10px
        bindsym Up resize shrink height 10px
        bindsym Right resize grow width 10px
        bindsym Return mode "default"
        bindsym Escape mode "default"
    }

#
# auto launch applications


workspace $workspace_web
exec flatpak run org.mozilla.firefox

workspace $workspace_code
exec foot

workspace $workspace_signal
exec flatpak run org.signal.Signal

workspace $workspace_slack
exec flatpak run com.slack.Slack

workspace $workspace_mattermost
exec flatpak run com.mattermost.Desktop

workspace $workspace_joplin
exec flatpak run net.cozic.joplin_desktop

exec /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec mako
exec ~/.config/waybar/launch-waybar.sh
exec swayidle -w \
         timeout 300 'swaylock -d -f -c 000000' \
         timeout 600 'swaymsg "output * dpms off"' resume 'swaymsg "output * dpms on"' \
         before-sleep 'swaylock -d -f -c 000000'

include /etc/sway/config.d/*
